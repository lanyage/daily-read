# 负载均衡
## 为什么需要负载均衡？
肯定是用来分发网络请求啦。
## 网络请求是什么样子？
以太网帧（MAC地址）

ip数据报（IP地址）

tcp报文（端口）

http报文（get/www.baidu.com）
## 网络请求每次都要经过哪些服务器？
客户端->LB->真实服务器->LB->客户端,LB相当于是网关服务器,对内对外都有一个IP。
## 上面有一个缺点，因为所有的返回流量都经过了LB，这样的话流量太大了，有解决方案吗？
客户端->LB->真实服务器->客户端。
原理就是让LB和所有真实服务器都有一个相同的VIP,这样数据包发过来之后,经过LB之后到达,LB通过ARP进行广播vip的真实服务器,通过某种策略只选择一个响应的真实服务器,然后将真实服务器就可以拿到数据包，处理完之后直接返回给客户端,这样客户端只会感觉有一个服务器。

上面就叫做责任分离。LB只做请求分发,真实服务器进行响应。请求和响应分离。

## 万一LB挂了呢？
这个就是一个致命的问题了，那就只好做双机热备了。就是使用两台LB,使VIP在两台机器上漂移,master会不断给backup发心跳,如果Master挂了就没有了心跳,那么backup就成为master，万一master活了呢？那就看谁的优先级高了,抢占式的。
## 还有一个问题,因为数据是在链路层发送,需要mac地址,如果master挂了,客户端实际上还是会往原先挂了的master上发包。
既然ip都可以用虚拟ip地址,那么mac地址也用虚拟的就好了。哈哈哈，机智。

